syntax = "proto3";
package bastionlab;

message ReferenceRequest {
    string identifier = 1;
    ClientInfo client_info = 2;
}

message ReferenceResponse {
    string identifier = 1;
    string header = 2;
}

message ReferenceList {
    repeated ReferenceResponse list = 1;
}

message Chunk {
    oneof chunk_type {
        bytes data = 1;
        ClientInfo client_info = 2;
    }
}

message Query {
    string composite_plan = 1;
    ClientInfo client_info = 2;
}

message ListDataFramesRequest {
    ClientInfo client_info = 1;
}

message ClientInfo {
    string uid = 1;
    string platform_name = 2;
    string platform_arch = 3;
    string platform_version = 4;
    string platform_release = 5;
    string user_agent = 6;
    string user_agent_version = 7;
}

service BastionLab {
    rpc SendDataFrame (stream Chunk) returns (ReferenceResponse) {}
    rpc RunQuery (Query) returns (ReferenceResponse) {}
    rpc FetchDataFrame (ReferenceRequest) returns (stream Chunk) {}
    rpc ListDataFrames (ListDataFramesRequest) returns (ReferenceList) {}
    rpc GetDataFrameHeader (ReferenceRequest) returns (ReferenceResponse) {}
}
